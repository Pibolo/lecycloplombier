!function(a){a.fn.tagcloud=function(b){var d=a.extend(a.fn.tagcloud.defaults,b);return d.drawing_interval=1/(d.fps/1e3),a(this).each(function(){a("ul",a(this)).css("display","none"),new c(a(this),d)}),this},a.fn.tagcloud.defaults={zoom:90,max_zoom:120,min_zoom:25,zoom_factor:2,rotate_factor:-.45,fps:10,centrex:250,centrey:250,min_font_size:12,max_font_size:32,font_units:"px",random_points:0};var c=function(c,d){function w(a){function b(a){return rgb=a.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/),rgb.length>3?{r:parseInt(rgb[1]),g:parseInt(rgb[2]),b:parseInt(rgb[3])}:{r:0,g:0,b:0}}function c(a){var b=0,c=0,d=0;return a.length>4?(b=parseInt(a.substr(1,2),16),c=parseInt(a.substr(3,2),16),d=parseInt(a.substr(5,2),16)):(b=parseInt(a.substr(1,1)+a.substr(1,1),16),c=parseInt(a.substr(2,1)+a.substr(2,1),16),d=parseInt(a.substr(3,1)+a.substr(3,1),16)),{r:b,g:c,b:d}}return"#"===a.substr(0,1)?c(a):"rgb"===a.substr(0,3)?b(a):(void 0!=window.console&&console.log("unable to parse:'"+a+"' please ensure background and foreground colors for the container are set as hex values"),null)}function x(a){a>256&&(a=256),0>a&&(a=0);var b=y(u.r,v.r,a),c=y(u.g,v.g,a),d=y(u.b,v.b,a),e="rgb("+b+", "+c+", "+d+")";return e}function y(a,b,c){var d=b-a,e=d/100,f=Math.round(a+c*e);return f}function z(a,b){for(var c in q.data){var d=a*q.data[c].y+b*q.data[c].z;q.data[c].y=b*q.data[c].y-a*q.data[c].z,q.data[c].z=d}}function A(a,b){for(var c in q.data){var d=-a*q.data[c].x+b*q.data[c].z;q.data[c].x=b*q.data[c].x+a*q.data[c].z,q.data[c].z=d}}function C(a){m+=a*l.zoom_factor,m>l.max_zoom&&(m=l.max_zoom),m<l.min_zoom&&(m=l.min_zoom),n=-(m*(e-l.max_zoom)/100)+e}function D(a,b){if(a>o){var c=a-o,e=-Math.sin(c*d.rotate_factor*f),g=Math.cos(c*d.rotate_factor*f);A(e,g)}if(o>a){var c=o-a,e=Math.sin(c*d.rotate_factor*f),g=Math.cos(c*d.rotate_factor*f);A(e,g)}if(b>p){var c=b-p,e=Math.sin(c*d.rotate_factor*f),g=Math.cos(c*d.rotate_factor*f);z(e,g)}if(p>b){var c=p-b,e=-Math.sin(c*d.rotate_factor*f),g=Math.cos(c*d.rotate_factor*f);z(e,g)}o=a,p=b,i=!0}function E(){if(i){var b=1e4,c=-1e4;for(var d in q.data)q.data[d].z<b&&(b=q.data[d].z),q.data[d].z>c&&(c=q.data[d].z);var f=Math.min(b,c),g=Math.max(b,c),h=g-f;for(var k in q.data){var l=(n-e)/(q.data[k].z-e),m=Math.round(100*((g-q.data[k].z)/h)),o=x(m);a("#"+q.data[k].id+" a",j).css("color",o),a("#"+q.data[k].id,j).css("z-index",m),a("#"+q.data[k].id,j).css("left",l*q.data[k].x+s-q.data[k].cwidth),a("#"+q.data[k].id,j).css("top",l*q.data[k].y+t)}i=!1}}a(c).css("position","relative");var e=-500,f=Math.PI/180;Math.cos(0),new Array("0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f");var n,i=!0,j=a(c),k="tc_"+a(c).attr("id")+"_",l=d,m=l.zoom,o=0,p=0,q=[];q.data=[];var r,u,v,s=d.centrex,t=d.centrey;if(u=d.background_colour?w(d.background_colour):w(a(c).css("background-color")),v=d.foreground_colour?w(d.foreground_colour):w(a(c).css("color")),q.count=a("li a",j).length,q.largest=1,q.smallest=0,a("li a",j).each(function(b){var d=parseInt(a(this).attr("rel"));0==d&&(d=1),q.data[b]={id:k+b,size:d};var e=-1+2*b/(q.count-1);q.data[b].theta=Math.acos(e),q.data[b].phi=0==b||b==q.count-1?0:(q.data[b-1].phi+3.6/Math.sqrt(q.count*(1-Math.pow(e,2))))%(2*Math.PI),q.data[b].x=Math.cos(q.data[b].phi)*Math.sin(q.data[b].theta)*(s/2),q.data[b].y=Math.sin(q.data[b].phi)*Math.sin(q.data[b].theta)*(t/2),q.data[b].z=Math.cos(q.data[b].theta)*(s/2),d>q.largest&&(q.largest=d),d<q.smallest&&(q.smallest=d),j.append('<div id="'+k+b+'" class="point" style="position:absolute;display:none;"><a href='+a(this).attr("href")+">"+a(this).html()+"</a></div>")}),l.random_points>0)for(b=0;b<l.random_points;b++)q.count++,q.data[q.count]={id:k+q.count,size:1},q.data[q.count].theta=2*Math.random()*Math.PI,q.data[q.count].phi=2*Math.random()*Math.PI,q.data[q.count].x=Math.cos(q.data[q.count].phi)*Math.sin(q.data[q.count].theta)*(s/2),q.data[q.count].y=Math.sin(q.data[q.count].phi)*Math.sin(q.data[q.count].theta)*(t/2),q.data[q.count].z=Math.cos(q.data[q.count].theta)*(s/2),j.append('<div id="'+k+q.count+'" class="point" style="position:absolute;"><a>.</a></div>');var F=q.largest-q.smallest+1,G=l.max_font_size-l.min_font_size+1;for(var H in q.data){var I=q.data[H].size,J=parseInt(I/F*G)+l.min_font_size;a("#"+q.data[H].id,j).hasClass("background")||a("#"+q.data[H].id,j).css("font-size",J),q.data[H].cwidth=a("#"+q.data[H].id,j).width()/2}a("ul",j).remove(),n=-(m*(e-l.max_zoom)/100)+e,D(s,t),E(),a(".point",j).css("display","inherit"),r=setInterval(E,l.drawing_interval),j.mousemove(function(a){D(a.clientX,a.clientY)}),j.mousewheel(function(a,b){return C(b),a.preventDefault(),!1})}}(jQuery);